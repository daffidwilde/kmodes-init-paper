\begin{algorithm}[H]
\caption{Capacitated Gale-Shapley}\label{alg:cap-galeshapley}
    \begin{algorithmic}[0]
        \For{\(s \in S\)}
            \State{\(M(s) \gets \emptyset\)}
	    \EndFor
        \For{\(r \in R\)}
            \State{\(M^{-1}(r) \gets \emptyset\)}
	    \EndFor%
        \State{\(S_u \gets S\)}
        \\
        \While{\(|S_u| > 0\)}
            \State{Select any \(s \in S_u\).}
            \If{\(|f(s)| = 0\)}
                \State{\(S_u \gets S_u \setminus \{s\}\)}
		    \Else%
                \State{Select \(s\)'s most preferred reviewer \(r \in R\).}
                \If{\(|M(r)| < c_r\)}
                    \State{\(M(r) \gets M(r) \cup \{s\}\)}
                    \State{\(S_u \gets S_u \setminus \{s\}\)}
		        \Else%
                    \For{\(s' \in M(r)\)}
                        \If{\(s \notin M(r)\)}
                            \If{\(r\) prefers \(s\) to \(s'\)}
                                \State{\(M(r) \gets M(r) \cup \{s\}\)}
                                \State{\(S_u \gets S_u \cup \{s\}\)}
                                \State{\(M(r) \gets M(r) \setminus \{s'\}\)}
                                \State{\(S_u \gets S_u \cup \{s'\}\)}
				            \Else%
                                \State{\(f(s) \gets f(s) \setminus \{r\}\)}
				            \EndIf%
			            \EndIf%
			        \EndFor%
		        \EndIf%
		    \EndIf%
	    \EndWhile%
	\end{algorithmic}
\end{algorithm}
